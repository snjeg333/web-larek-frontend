# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
export interface IProduct {
	id: string;
	title: string;
	category: string;
	description: string;
	image?: string;
	price: number | null;
}
```

Модель приложения

```
export interface IAppState {
	catalog: IProductItem[];
	basket: string[];
	preview: string | null;
	order: IOrder | null;
}
```

Форма заказа

```
export interface IOrderForm {
	payment?: string;
	email?: string;
	phone?: string;
	address?: string;
	total?: number | string;
}
```

Форма карточки

```
export interface ICard {
	index: number;
	title: string;
	price: string;
	description: string;
	category: string;
	image: string;
	button: string;
}
```

Форма полного заказа

```
export interface IOrder extends IOrderForm {
	items: string[];
}
```

Управления событиями в приложении

```
export interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- Слой отображения (View) — для взаимодействия с пользователем.
- Слой представления (Presenter) — соединяет отображение, данные и коммуникацию.
- Слой данных (Model) — содержит значительную часть бизнес-логики.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

- constructor(baseUrl: string, options: RequestInit = {})
  Методы:
- `get` - получение данных
- `post` - отправка данных

#### Класс EventEmitter implements IEvents

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Свойства класса:

- _events: Map<EventName, Set> - это коллекция событий и их подписчиков.
  Методы класса:
- `on` - подписка на событие
- `off` - снимает обработчик с события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
- `onAll` - Слушать все события
- `offAll` - Сбросить все обработчики

#### Класс Component<T>

Используется для создания компонентов пользовательскоего интерфейса.

Конструктор:

- constructor(protected readonly container: HTMLElement) - инициализация компонента в заданном контейнере

Методы класса:

- toggleClass - позволяет переключать класс компонента
- setText - позволяет установить текстовое содержимое компонента
- setDisabled - позволяет изменить статус блокировки компонента
- setHidden - позволяет скрыть компонент
- setVisible - позволяет сделать компонент видимым
- setImage - позволяет установить изображение с альтернативным текстом
- render - позволяет вернуть корневой DOM-элемент

#### Класс Model<T>

Инициализирует модель данных приложения.
Конструктор:

- constructor(data: Partial<T>, protected events: IEvents) - инициализирут модель данных, и подключает события

Методы класса

- emitChanges - сообщает всем что модель поменялась

### Слой данных

#### Класс AppState extends Model<IAppState>

Содержит состояние корзины, заказа, каталога и ошибок валидации. Наследуеются от класса Model

В полях класса хранятся следующие данные:

- basketList: IProduct[] = []; - хранилище товаров, добавленных в корзину
- catalog: IProduct[]; - хранилище всех товаров, полученых с сервера
- order: IOrder = {...}; - хранилище всех данных, сформированных для отправки заявки заказа
- preview: string | null; - хранилище данных для превью
- formErrors: FormErrors = {}; - хранилище ошибок валидации
- buttonName: 'Купить' | 'Убрать из корзины'; - представляющее собой строку, которая может быть либо 'Купить', либо 'Убрать из корзины'

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- getButtonName(value: string): string - проверяет наличие продукта в корзине по его названию
- setCatalog(items: IProduct[]) - добавляет данные товара в поле каталога
- addBasketList(item: IProduct) - добавляет данные товара в поле корзины
- changeBasketList(id: string) - удаляет выбранный товар из корзины
- clearBasket - очищает корзину
- getTotal - возвращает общее количество продуктов в корзине
- getTotalPrice - вычисляет и возвращает общую стоимость всех продуктов в корзине
- setPreview(item: IProduct) - добавляет данные товара id в поле preview
- validateOrder - проверка ошибок валидации заказа
- setOrderField(field: keyof IOrderForm, value: string) - устанавливает данные в поле заказа

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Basket extends Component<IBasketView>

Выводит на страницу контент корзины в модальном окне

Коннструктор:

- constructor(container: HTMLElement, protected events: IEvents) - принимает контейнер, и объект событий

Поля являются HTML элементами:

- "list" - список товаров в корзине
- "total" - итоговая сумма заказа
- "button" - кнопка оформления заказа
  Методы:
- set items - сеттер, добавляющий список всех элементов, добавленных в корзину
- set selected - сеттер, позволяющий блокировать/разблокировать кнопку оформления
- set total - сеттер, позволяющий установить итоговую сумму всех товаров в корзине

#### Класс Form<T> extends Component<IFormState>

Преднозначен для форм приложения

Конструктор:

- constructor(protected container: HTMLFormElement, protected events: IEvents) - принимает container и объект с событиями

Поля класса являются HTML элементами:

- "submit" - кнопка подтверждения формы
- "errors" - элемент вывода ошибок валидации
  Методы:
- onInputChange - выводит ошибку в разметку
- set valid - сеттер, позволяющий блокировать/разблокировать кнопку подтверждения
- set errors - сеттер, утсанавливаюший текст ошибки
- render - вызывает родительский метод

#### Класс Card extends Component<ICard>

Класс предназначен для вывода товара на страницу

Конструктор:

- constructor(protected blockName: string, container: HTMLElement) - принимает карточку и действия с ней

Поля класса являются HTML элементами:

- title - заголовок
- price - стоимость
- category - категория
  Методы:

- set/get id - геттер/сеттер, устанавливающий id карточки
- set/get title - геттер/сеттер, устанавливающий заголовок карточки
- set price - сеттер, устанавливающий стоимость карточки
- set image - сеттер, для установки изображения карточки
- set category - сеттер, для установки категории карточки

#### Класс Modal extends Component<IModalData>

Отвечает за работу модальных окон и вывод в них контента;

Конструктор:

- constructor(container: HTMLElement, protected events: IEvents) - принимает модальное окно и объект управления событиями

Поля класса являются HTML элементами:

- "closeButton" - кнопка закрытия модального окна
- "content" - элкмент с контентом
  Методы:
- set content(value: HTMLElement) – помещает контент в выбранный контейнер
- open - открытие модального окна
- close - закрытие модального окна
- render(data: IModalData) - возвращает корневой DOM-элемент для отрисовки

#### Класс AuctionAPI extends Api implements IAuctionAPI

Кастомная реализация взаимодействия с сервером

Конструктор:

- constructor(cdn: string, baseUrl: string, options?: RequestInit) - принимает ссылку на изображение, основной url и настройки запроса.

Методы класса:

- getProducts(): Promise<IProduct[]> - получение карточек с сервера.
- postOrder(order: IOrder): Promise<IOrder> - отправка данных по заказу.

#### Класс Order extends Form<IOrderForm>

Отрисовывает форму выбора способа оплаты и добавления места доставки

Конструктор:

- constructor(container: HTMLFormElement, events: IEvents) - принимает родительский элемент и обработчик событий.

Поля класса являются HTML элементами:

- \_buttonsCard - кнопки "card"
- \_buttonsCash - кнопка "cash"

Методы:

- set address(value: string) - сеттер, устанавливаюший адрес доставки

#### Класс Contacts extends Form<IOrderForm>

Отрисовывает форму заполнения контактных данных.

Конструктор:

- constructor(container: HTMLFormElement, events: IEvents) - принимает родительский элемент и обработчик событий

  Методы:

- set phone - сеттер, устанавливающий номер телефона
- set email - сеттер, устанавливающий адрес электронной почты

#### Класс Page extends Component<IPage>

Предназначен для вывода основных данных на страницу;

Конструктор:

- constructor(container: HTMLElement, protected events: IEvents) - принимает родительский элемент и обработчик событий.

Поля класса являются HTML элементами:

- "\_counter" - счетчик количества товаров в корзине
- "\_catalog" - контейнер галереи товаров
- "\_wrapper" - основной контейнер всей страницы
- "\_basket" - кнопка корзины
  Методы:
- "set counter" - сеттер, позволяющий установить значение добавленных карточек в счетчик корзины
- "set catalog" - сеттер, позволяющий добавить карточки товаров в контейнер
- "set locked" - сеттер, позволяющий блокировать прокрутку страницы если открыта модалка;

#### Success extends Component<ISuccess>

Класс отображения сообщения об успешном оформлении заказа.

Методы / свойства класса:

Конструктор:

- constructor(container: HTMLElement, actions: ISuccessActions) — принимает HTML-элемент и объект действий для обработки событий клика;
- total — устанавливает стоимость заказа.

_Список всех событий, которые могут генерироваться в системе:_

- items:changed - Событие, вызываемое при получении данных о продуктах из API. Обработчик этого события должен обновлять список продуктов на главной странице.
- card:select - Событие, возникающее при клике по карточке продукта на главной странице. Обработчик этого события должен открыть модальное окно с подробной информацией о продукте.
- basket:open - Событие, вызываемое при клике по кнопке корзины в заголовке. Обработчик этого события должен открыть модальное окно с корзиной.
- basket:changed - Событие, вызываемое при добавлении продукта в корзину. Обработчик этого события должен обновить список продуктов в корзине и пересчитать общую стоимость заказа.
- item:remove - Событие, вызываемое при удалении продукта из корзины. Обработчик этого события должен обновить список продуктов в корзине и пересчитать общую стоимость заказа.
- order:open - Событие, вызываемое при переходе к оформлению заказа. Обработчик этого события должен открыть форму оформления заказа.
- order:submit - Событие, вызываемое при отправке формы оформления заказа. Обработчик этого события должен отправить данные заказа на сервер.
- contacts:submit - Событие, вызываемое при успешной отправке заказа. Обработчик этого события должен показать сообщение об успешном оформлении заказа.
- formOrderErrors:change - Событие, вызываемое при ошибке валидации заказа. Обработчик этого события должен показать сообщение об ошибке.
- modal:open - Событие, вызываемое при открытии любого модального окна. Обработчик этого события должен заблокировать прокрутку страницы.
- modal:close - Событие, вызываемое при закрытии любого модального окна. Обработчик этого события должен разблокировать прокрутку страницы.
